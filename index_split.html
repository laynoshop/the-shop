<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#bb0000" />
  <title>The Shop</title>

  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <!-- LOGIN -->
  <div id="login">
    <div class="loginCard">
      <div class="loginTop">
        <div class="loginKicker">The Shop</div>
        <div class="loginTitle">Enter the Scarlet Key</div>
      </div>

      <div class="loginRow">
        <input
          type="password"
          id="code"
          placeholder="Scarlet Key"
          inputmode="numeric"
          autocomplete="one-time-code"
        />
        <button id="loginBtn" type="button" disabled>Loading…</button>
      </div>

      <div class="loginSub">Authorized members only</div>
    </div>
  </div>

  <!-- ENTRY (Doors) -->
  <div id="entry" style="display:none;">
    <div class="entryWrap">
      <div class="entryHeader">
        <div class="entryTitle">The Shop</div>
        <div class="entrySub">446 DAYS SINCE TTUN WON IN THE GAME</div>
      </div>

      <div class="doors">
        <button class="doorBtn" data-go="scores">Scores</button>
        <button class="doorBtn" data-go="picks">Picks</button>
        <button class="doorBtn" data-go="beat">Beat TTUN</button>
        <button class="doorBtn" data-go="news">Top News</button>
        <button class="doorBtn" data-go="shop">Shop</button>
      </div>
    </div>
  </div>

  <!-- APP -->
  <div id="app" style="display:none;">
    <div id="content"></div>
    <div class="tabs"></div>
    <div id="rivalryBanner" class="rivalryBanner"></div>
  </div>

  <script>
    // If any script 404s, you'll get an instant alert telling you which one.
    window.__splitFail = function (file) {
      alert("❌ Failed to load: " + file + "\nCheck that it exists at /" + file + " (case-sensitive) and is pushed to GitHub.");
    };
  </script>

  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- ✅ SPLIT BUILD (order matters) -->
  <script src="split/boot.js" defer onerror="__splitFail('split/boot.js')"></script>
  <script src="split/shared.js" defer onerror="__splitFail('split/shared.js')"></script>

  <script src="split/scores.js" defer onerror="__splitFail('split/scores.js')"></script>
  <script src="split/news.js" defer onerror="__splitFail('split/news.js')"></script>
  <script src="split/beat.js" defer onerror="__splitFail('split/beat.js')"></script>
  <script src="split/shop.js" defer onerror="__splitFail('split/shop.js')"></script>
  <script src="split/logout.js" defer></script>
  <script src="split/groupPicks.js" defer onerror="__splitFail('split/groupPicks.js')"></script>

  <script src="split/app.js" defer onerror="__splitFail('split/app.js')"></script>

  <!-- ✅ READY GATE -->
  <script>
    (function () {
      const btn = document.getElementById("loginBtn");
      const code = document.getElementById("code");

      function tryEnable() {
        if (typeof window.checkCode === "function") {
          if (btn) { btn.disabled = false; btn.textContent = "Unlock"; }
          if (btn) btn.onclick = () => window.checkCode();
          if (code) {
            code.addEventListener("keydown", (e) => {
              if (e.key === "Enter") {
                e.preventDefault();
                window.checkCode();
              }
            });
          }
          return true;
        }
        return false;
      }

      if (tryEnable()) return;

      let ticks = 0;
      const t = setInterval(() => {
        ticks++;
        if (tryEnable()) return clearInterval(t);
        if (ticks >= 160) {
          clearInterval(t);
          if (btn) {
            btn.disabled = true;
            btn.textContent = "Load error";
            btn.onclick = () => alert("Split scripts loaded but checkCode was not found. Next step: tell me if you saw ANY ❌ alert and which file it named.");
          }
        }
      }, 50);
    })();
  </script>
</body>
</html>