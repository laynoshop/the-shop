<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#bb0000" />
  <title>The Shop</title>

  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <!-- LOGIN -->
  <div id="login">
    <div class="loginCard">
      <div class="loginTop">
        <div class="loginKicker">The Shop</div>
        <div class="loginTitle">Enter the Scarlet Key</div>
      </div>

      <div class="loginRow">
        <input
          type="password"
          id="code"
          placeholder="Scarlet Key"
          inputmode="numeric"
          autocomplete="one-time-code"
        />
        <button id="loginBtn" type="button" disabled>Loading…</button>
      </div>

      <div class="loginSub">Authorized members only</div>
    </div>
  </div>

  <!-- ENTRY (Doors) -->
  <div id="entry" style="display:none;">
    <div class="entryWrap">
      <div class="entryHeader">
        <div class="entryTitle">The Shop</div>
        <div class="entrySub">446 DAYS SINCE TTUN WON IN THE GAME</div>
      </div>

      <div class="doors">
        <button class="doorBtn" data-go="scores">Scores</button>
        <button class="doorBtn" data-go="picks">Picks</button>
        <button class="doorBtn" data-go="beat">Beat TTUN</button>
        <button class="doorBtn" data-go="news">Top News</button>
        <button class="doorBtn" data-go="shop">Shop</button>
      </div>
    </div>
  </div>

  <!-- APP -->
  <div id="app" style="display:none;">
    <div id="content"></div>

    <!-- Tabs row (must sit directly above rivalry banner) -->
    <div class="tabs"></div>

    <!-- Rivalry banner fixed at the VERY bottom -->
    <div id="rivalryBanner" class="rivalryBanner"></div>
  </div>

  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script src="script.js" defer></script>

  <!-- ✅ READY GATE: enables login only when checkCode exists -->
  <script>
    (function () {
      const btn = document.getElementById("loginBtn");
      const code = document.getElementById("code");

      function tryEnable() {
        if (typeof window.checkCode === "function") {
          if (btn) { btn.disabled = false; btn.textContent = "Unlock"; }
          if (btn) btn.onclick = () => window.checkCode();
          if (code) {
            code.addEventListener("keydown", (e) => {
              if (e.key === "Enter") {
                e.preventDefault();
                window.checkCode();
              }
            });
          }
          return true;
        }
        return false;
      }

      if (tryEnable()) return;

      // wait up to ~8 seconds, then show a clearer error
      let ticks = 0;
      const t = setInterval(() => {
        ticks++;
        if (tryEnable()) return clearInterval(t);
        if (ticks >= 160) { // 160 * 50ms = 8s
          clearInterval(t);
          if (btn) {
            btn.disabled = true;
            btn.textContent = "Load error";
            btn.onclick = () => alert("Split scripts failed to load. Open /index_split.html in Safari and check console.");
          }
        }
      }, 50);
    })();
  </script>
</body>
</html>